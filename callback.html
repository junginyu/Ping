<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>카카오 간편로그인 콜백</title>
    <!-- 카카오 JavaScript SDK -->
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
    <!-- Config 파일 -->
    <script src="config.js"></script>
  </head>
  <body>
    <div id="message">로그인 중...</div>

    <script>
      // 카카오 SDK 초기화
      Kakao.init(KAKAO_JAVASCRIPT_KEY); // 발급받은 JavaScript 키를 사용합니다.
      console.log(Kakao.isInitialized()); // SDK 초기화 여부 확인 (true)

      // 리디렉트 URI에서 인가 코드를 받아 액세스 토큰 요청
      function getAccessTokenFromUrl() {
        const url = new URL(window.location.href);
        const code = url.searchParams.get("code");
        if (code) {
          fetch(`https://kauth.kakao.com/oauth/token`, {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
            body: new URLSearchParams({
              grant_type: "authorization_code",
              client_id: KAKAO_JAVASCRIPT_KEY,
              redirect_uri: "http://localhost:5500/callback.html",
              code: code,
            }),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.access_token) {
                Kakao.Auth.setAccessToken(data.access_token);
                window.location.href = "http://localhost:5500/index.html";
              } else {
                console.error("Access token not found in response:", data);
                document.getElementById("message").textContent = "로그인 실패";
              }
            })
            .catch((error) => {
              console.error("Error:", error);
              document.getElementById("message").textContent = "로그인 실패";
            });
        } else {
          console.error("Authorization code not found in URL");
          document.getElementById("message").textContent = "로그인 실패";
        }
      }

      // 페이지 로드 시 토큰 확인 및 사용자 정보 요청
      window.onload = function () {
        getAccessTokenFromUrl();
      };
    </script>
  </body>
</html>
